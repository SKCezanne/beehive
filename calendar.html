<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Calendar - Event Hive</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="top-bar">
        <div class="nav-container">
            <div class="logo">üêù Event Hive</div>
            <div class="nav-right">
                <div class="notification-container">
                    <button class="notification-btn" onclick="toggleNotifications()">üîî</button>
                    <div class="notification-dropdown" id="notificationDropdown">
                        <div class="notification-header">Notifications</div>
                        <div class="notification-item">
                            <div class="notification-title">New Event: Dance Competition</div>
                            <div class="notification-time">2 hours ago</div>
                        </div>
                        <div class="notification-item">
                            <div class="notification-title">Registration Open: Art Exhibition</div>
                            <div class="notification-time">5 hours ago</div>
                        </div>
                    </div>
                </div>
                <a href="index.html" class="calendar-btn">üè† Home</a>
            </div>
        </div>
    </nav>

    <section class="calendar-section">
        <div class="container">
            <h1 class="calendar-title">Event Calendar</h1>
            <div class="calendar-container">
                <div class="calendar-month">
                    <div class="month-header">
    <button id="prevMonth">‚óÄ</button>
    <h2 id="calendarTitle"></h2>
    <button id="nextMonth">‚ñ∂</button>
</div>

                    <div class="calendar-grid">
                        <div class="calendar-day-header">Sun</div>
                        <div class="calendar-day-header">Mon</div>
                        <div class="calendar-day-header">Tue</div>
                        <div class="calendar-day-header">Wed</div>
                        <div class="calendar-day-header">Thu</div>
                        <div class="calendar-day-header">Fri</div>
                        <div class="calendar-day-header">Sat</div>
                        
                        <div class="calendar-day"></div>
                        <div class="calendar-day"></div>
                        <div class="calendar-day"></div>
                        <div class="calendar-day"></div>
                        <div class="calendar-day"></div>
                        <div class="calendar-day">1</div>
                        <div class="calendar-day">2</div>
                        <div class="calendar-day">3</div>
                        <div class="calendar-day">4</div>
                        <div class="calendar-day">5</div>
                        <div class="calendar-day">6</div>
                        <div class="calendar-day">7</div>
                        <div class="calendar-day">8</div>
                        <div class="calendar-day">9</div>
                        <div class="calendar-day">10</div>
                        <div class="calendar-day">11</div>
                        <div class="calendar-day">12</div>
                        <div class="calendar-day">13</div>
                        <div class="calendar-day">14</div>
                        <div class="calendar-day event-day" data-event="Poetry Slam Night - 7:00 PM">15</div>
                        <div class="calendar-day">16</div>
                        <div class="calendar-day event-day" data-event="Art Exhibition - 10:00 AM">17</div>
                        <div class="calendar-day event-day" data-event="Art Exhibition - 10:00 AM">18</div>
                        <div class="calendar-day">19</div>
                        <div class="calendar-day event-day" data-event="Cricket Championship - 9:00 AM">20</div>
                        <div class="calendar-day">21</div>
                        <div class="calendar-day event-day" data-event="Gaming Tournament - 2:00 PM">22</div>
                        <div class="calendar-day">23</div>
                        <div class="calendar-day">24</div>
                        <div class="calendar-day event-day" data-event="Music Festival - 4:00 PM">25</div>
                        <div class="calendar-day">26</div>
                        <div class="calendar-day">27</div>
                        <div class="calendar-day">28</div>
                        <div class="calendar-day">29</div>
                        <div class="calendar-day">30</div>
                        <div class="calendar-day">31</div>
                    </div>
                </div>
                <div class="calendar-events-list">
                    <h3>Upcoming Events</h3>
                    <div class="event-list-item">
                        <div class="event-date">Mar 15</div>
                        <div class="event-info-cal">
                            <div class="event-name-cal">Poetry Slam Night</div>
                            <div class="event-time-cal">7:00 PM</div>
                        </div>
                    </div>
                    <div class="event-list-item">
                        <div class="event-date">Mar 17</div>
                        <div class="event-info-cal">
                            <div class="event-name-cal">Art Exhibition</div>
                            <div class="event-time-cal">10:00 AM</div>
                        </div>
                    </div>
                    <div class="event-list-item">
                        <div class="event-date">Mar 18</div>
                        <div class="event-info-cal">
                            <div class="event-name-cal">Art Exhibition</div>
                            <div class="event-time-cal">10:00 AM</div>
                        </div>
                    </div>
                    <div class="event-list-item">
                        <div class="event-date">Mar 20</div>
                        <div class="event-info-cal">
                            <div class="event-name-cal">Cricket Championship</div>
                            <div class="event-time-cal">9:00 AM</div>
                        </div>
                    </div>
                    <div class="event-list-item">
                        <div class="event-date">Mar 22</div>
                        <div class="event-info-cal">
                            <div class="event-name-cal">Gaming Tournament</div>
                            <div class="event-time-cal">2:00 PM</div>
                        </div>
                    </div>
                    <div class="event-list-item">
                        <div class="event-date">Mar 25</div>
                        <div class="event-info-cal">
                            <div class="event-name-cal">Music Festival</div>
                            <div class="event-time-cal">4:00 PM</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
function toggleNotifications() {
    const dropdown = document.getElementById('notificationDropdown');
    dropdown.classList.toggle('show');
}
function goToEvent(eventTime) {
    const eventDate = new Date(eventTime);

    // Switch calendar to that month
    currentDate = new Date(eventDate.getFullYear(), eventDate.getMonth(), 1);
    renderCalendar();

    // Small delay so grid renders first
    setTimeout(() => {
        const days = document.querySelectorAll('.calendar-day');

        days.forEach(day => {
            if (day.textContent == eventDate.getDate()) {
                day.classList.add('highlight-day');

                // Remove highlight after 2 seconds
                setTimeout(() => {
                    day.classList.remove('highlight-day');
                }, 2000);
            }
        });
    }, 50);
}


window.addEventListener('click', function(e) {
    if (!e.target.matches('.notification-btn')) {
        const dropdown = document.getElementById('notificationDropdown');
        if (dropdown.classList.contains('show')) {
            dropdown.classList.remove('show');
        }
    }
});

const API_BASE = window.location.origin;

let currentDate = new Date();
let allEvents = [];

async function loadEvents() {
            const grid = document.getElementById('eventsGrid');
            try {
                const res = await fetch(`${API_BASE}/api/events`);
                if (!res.ok) throw new Error('Failed to load events');
                const events = await res.json();
                updateNotifications(events);

            } catch (err) {
                grid.innerHTML = '<p class="events-error">Could not load events. Make sure the backend is running at ' + API_BASE + '</p>';
            }
        }

async function loadCalendar() {
    const res = await fetch(`${API_BASE}/api/events`);
    allEvents = await res.json();
    renderCalendar();
    populateEventList(allEvents);
    updateNotifications(events);
}

function renderCalendar() {
    const grid = document.querySelector('.calendar-grid');

    const headers = Array.from(grid.querySelectorAll('.calendar-day-header'));
    grid.innerHTML = '';
    headers.forEach(h => grid.appendChild(h));

    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();

    const monthNames = [
        "January","February","March","April","May","June",
        "July","August","September","October","November","December"
    ];

    document.getElementById('calendarTitle').textContent =
        `${monthNames[month]} ${year}`;

    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    for (let i = 0; i < firstDay; i++) {
        grid.innerHTML += `<div class="calendar-day"></div>`;
    }

    for (let day = 1; day <= daysInMonth; day++) {
        const fullDate = new Date(year, month, day);

        const dayEvents = allEvents.filter(e => {
            const eventDate = new Date(e.time);
            return (
                eventDate.getDate() === fullDate.getDate() &&
                eventDate.getMonth() === fullDate.getMonth() &&
                eventDate.getFullYear() === fullDate.getFullYear()
            );
        });

        if (dayEvents.length > 0) {
            grid.innerHTML += `
                <div class="calendar-day event-day"
                     data-events="${dayEvents.map(e =>
                        e.name + ' - ' +
                        new Date(e.time).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})
                     ).join(', ')}">
                    ${day}
                </div>
            `;
        } else {
            grid.innerHTML += `<div class="calendar-day">${day}</div>`;
        }
    }

    addTooltips();
}

function updateNotifications(events) {
    const dropdown = document.getElementById('notificationDropdown');
    const header = dropdown.querySelector('.notification-header');

    // Clear old items except header
    dropdown.innerHTML = '';
    dropdown.appendChild(header);

    const notifications = [];

    const now = new Date();
    const tomorrow = new Date();
    tomorrow.setDate(now.getDate() + 1);

    const seenEventIds = JSON.parse(localStorage.getItem('seenEvents') || '[]');

    events.forEach(event => {
        const eventDate = new Date(event.time);

        // New event notification
        if (!seenEventIds.includes(event.id)) {
            notifications.push({
                title: `New Event: ${event.name}`,
                time: 'Just added'
            });
            seenEventIds.push(event.id);
        }

        // Reminder for tomorrow
        if (
            eventDate.getDate() === tomorrow.getDate() &&
            eventDate.getMonth() === tomorrow.getMonth() &&
            eventDate.getFullYear() === tomorrow.getFullYear()
        ) {
            notifications.push({
                title: `Reminder: ${event.name} is tomorrow`,
                time: eventDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
            });
        }
    });

    localStorage.setItem('seenEvents', JSON.stringify(seenEventIds));

    if (notifications.length === 0) {
        const empty = document.createElement('div');
        empty.className = 'notification-item';
        empty.innerHTML = `<div class="notification-title">No new notifications</div>`;
        dropdown.appendChild(empty);
        return;
    }

    notifications.forEach(n => {
        const item = document.createElement('div');
        item.className = 'notification-item';
        item.innerHTML = `
            <div class="notification-title">${n.title}</div>
            <div class="notification-time">${n.time}</div>
        `;
        dropdown.appendChild(item);
    });
}

function populateEventList(events) {
    const container = document.querySelector('.calendar-events-list');

    const upcoming = events
        .filter(e => new Date(e.time) >= new Date())
        .sort((a, b) => new Date(a.time) - new Date(b.time));

    container.innerHTML = `<h3>Upcoming Events</h3>`;

    upcoming.forEach(event => {
        const date = new Date(event.time);

        container.innerHTML += `
    <div class="event-list-item"
         onclick="goToEvent('${event.time}')">
        <div class="event-date">
            ${date.toLocaleDateString('en-IN', { month:'short', day:'numeric' })}
        </div>
        <div class="event-info-cal">
            <div class="event-name-cal">${event.name}</div>
            <div class="event-time-cal">
                ${date.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}
            </div>
        </div>
    </div>
`;

    });
}

function addTooltips() {
    document.querySelectorAll('.event-day').forEach(day => {
        day.addEventListener('mouseenter', function() {
            const tooltip = document.createElement('div');
            tooltip.className = 'event-tooltip';
            tooltip.textContent = this.dataset.events;
            document.body.appendChild(tooltip);

            const rect = this.getBoundingClientRect();

            let top = rect.top - tooltip.offsetHeight - 10;
            let left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2);

            // If too close to top ‚Üí show below instead
            if (top < 10) {
                top = rect.bottom + 10;
            }

            // Prevent overflow left
            if (left < 10) {
                left = 10;
            }

            // Prevent overflow right
            if (left + tooltip.offsetWidth > window.innerWidth - 10) {
                left = window.innerWidth - tooltip.offsetWidth - 10;
            }

            tooltip.style.position = 'fixed';
            tooltip.style.top = top + 'px';
            tooltip.style.left = left + 'px';
        });

        day.addEventListener('mouseleave', function() {
            const tooltip = document.querySelector('.event-tooltip');
            if (tooltip) tooltip.remove();
        });
    });
}


/* Month Navigation */
document.getElementById('prevMonth').addEventListener('click', () => {
    const title = document.getElementById('calendarTitle');
    title.classList.remove('slide-left');
    title.classList.add('slide-right');

    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar();

    setTimeout(() => title.classList.remove('slide-right'), 350);
});

document.getElementById('nextMonth').addEventListener('click', () => {
    const title = document.getElementById('calendarTitle');
    title.classList.remove('slide-right');
    title.classList.add('slide-left');

    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar();

    setTimeout(() => title.classList.remove('slide-left'), 350);
});


loadCalendar();
loadEvents();
</script>


</body>
</html>
